<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<title>Whack-a-Mole 🎯</title>
<style>
  :root{
    --cell: clamp(82px, 22vw, 120px);
    --gap:  clamp(8px, 2.6vw, 14px);
    --header-pad: max(10px, env(safe-area-inset-top, 0));
    --side-pad: max(12px, env(safe-area-inset-left, 0));
  }
  *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
  html, body { height:100%; overscroll-behavior: none; }
  .playing, .playing * { touch-action: none !important; }
  .lock { position: fixed; overflow: hidden; inset: 0; width: 100%; }

  body{
    margin:0; display:flex; flex-direction:column; align-items:center;
    font-family: ui-sans-serif, system-ui, -apple-system, "Pretendard","Segoe UI",sans-serif;
    background: url('https://i.postimg.cc/QCs9xJCp/image.png') center center / cover no-repeat fixed;
    min-height:100vh;
  }

  header{
    position:sticky; top:0; z-index:10; width:100%;
    display:flex; align-items:center; justify-content:space-between;
    padding: var(--header-pad) calc(var(--side-pad) + 12px) 10px calc(var(--side-pad) + 12px);
    background: transparent; backdrop-filter:none; -webkit-backdrop-filter:none; box-shadow:none;
  }
  #homeLogo{ display:inline-flex; align-items:center; cursor:pointer; }
  #homeLogo img{ height:40px; width:auto; object-fit:contain; image-rendering:auto; background:transparent; display:block; }

  .hud .btn{
    min-height:44px; min-width:44px; padding:8px 14px; font-size:16px; font-weight:700;
    border:0; border-radius:10px; cursor:pointer; background:rgba(17,17,17,.85); color:#fff;
  }

  .wrap{ width:min(760px,100%); padding:12px calc(var(--side-pad) + 12px) 0 }
  h1{ margin:8px 0 6px; color:#fff; text-shadow:0 2px 10px rgba(0,0,0,.4); font-size:clamp(18px,4.5vw,24px); font-weight:800; }
  #timer, #scoreboard{ color:#fff; text-shadow:0 1px 6px rgba(0,0,0,.45); font-size:clamp(14px,3.8vw,18px); margin-bottom:6px; }

  #grid{
    display:grid; grid-template-columns:repeat(3, var(--cell)); grid-auto-rows:var(--cell);
    gap:var(--gap); justify-content:center; width:100%; margin:8px 0 12px;
  }
  .hole{
    position:relative; width:var(--cell); height:var(--cell); border-radius:50%; overflow:hidden;
    background:#6a4a3c; box-shadow: inset 0 8px 24px #2a160f, 0 6px 18px rgba(0,0,0,.25);
  }
  .mole{
    position:absolute; top:60%; left:50%; transform:translate(-50%, -50%);
    width:78%; user-select:none; -webkit-user-drag:none; cursor:pointer; transition: top .18s ease;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,.35));
  }
  .mole.up{ top:28%; }

  button#start{
    display:inline-block; min-height:44px; min-width:120px; padding:10px 20px;
    font-size:16px; font-weight:800; border-radius:12px; border:0; background:#111; color:#fff;
    box-shadow:0 6px 18px rgba(0,0,0,.25);
  }

  #scoreboard-list{ width:min(760px,100%); padding:0 calc(var(--side-pad) + 12px); margin:12px 0 18px; }
  #scoreboard-list h2{ margin:6px 0 8px; color:#fff; text-shadow:0 1px 6px rgba(0,0,0,.45); font-size:clamp(16px,4vw,20px); }
  #scores{ list-style:none; padding:0; margin:0; }
  #scores li{
    background:rgba(255,255,255,.9); margin-bottom:6px; padding:8px 12px; border-radius:10px;
    box-shadow:0 2px 8px rgba(0,0,0,.18); display:flex; justify-content:space-between; font-weight:700;
  }

  /* 일시정지 오버레이 */
  #pauseOverlay{
    position: fixed; inset:0; display:none; place-items:center;
    background: rgba(0,0,0,.4);
    z-index: 20; color:#fff; text-align:center; padding:20px;
  }
  #pauseOverlay.show{ display:grid; }
  #pauseOverlay .card{
    background: rgba(0,0,0,.55);
    border: 1px solid rgba(255,255,255,.18);
    padding: 16px 20px; border-radius: 14px; backdrop-filter: blur(2px);
    max-width: 90vw;
  }
  #pauseOverlay h2{ margin: 0 0 6px; font-size: 22px; }
  #pauseOverlay p{ margin: 0 0 10px; opacity: .9; }
  #pauseOverlay .resume{
    padding:10px 18px; border-radius:12px; border:0; font-weight:800; font-size:16px; cursor:pointer;
  }

  footer{
    margin-top:auto; width:100%; text-align:center;
    padding:14px calc(var(--side-pad) + 12px) max(12px, env(safe-area-inset-bottom, 0));
    background: rgba(0,0,0,.6); color:#fff; font-size:14px;
  }

  @media (max-width: 600px){
    body{ background-attachment: scroll; }
    #grid{ gap:max(8px, 2vw); }
  }
</style>
</head>
<body>

<header>
  <div id="homeLogo" role="button" tabindex="0" title="초기 화면으로 이동">
    <img src="https://api.multicampus.com/ssf/v1/resource/public/images/FILBS202506207041267" alt="multicampus 로고" />
  </div>
  <div class="hud" aria-live="polite">
    <button id="pauseBtn" class="btn">⏸️ Pause</button>
  </div>
</header>

<div class="wrap">
  <h1>두더지 잡기 대작전</h1>
  <div id="timer">Time left: 30s</div>
  <div id="scoreboard">Score: <span id="score">0</span></div>

  <div id="grid"></div>
  <button id="start">Start Game</button>

  <div id="scoreboard-list" style="display:none;">
    <h2>👑 Scoreboard</h2>
    <ul id="scores"></ul>
  </div>
</div>

<!-- 일시정지 오버레이 -->
<div id="pauseOverlay" aria-hidden="true">
  <div class="card">
    <h2>일시정지 ⏸️</h2>
    <p>잠깐 쉬어가요. 계속하려면 아래 버튼을 눌러주세요.</p>
    <button class="resume">▶️ Resume</button>
  </div>
</div>

<audio id="bgm" src="https://www.dropbox.com/scl/fi/05ytgdfewmcgokh7onrzp/770707__audiocoffee__children-game-loop-ver.wav?rlkey=elzlfgeetnf16zieb8nrmri5j&raw=1" loop></audio>
<audio id="hitSound" src="https://www.dropbox.com/scl/fi/azmq2hkl45wns76novc2k/85591__jankoehl__hit-wood10.wav?rlkey=rcjxyhs5frxc1qaw0o2eegpku&raw=1"></audio>

<footer>© multicampus arcade</footer>

<script>
  const grid = document.getElementById('grid');
  const scoreEl = document.getElementById('score');
  const startBtn = document.getElementById('start');
  const timerEl = document.getElementById('timer');
  const scoreboardList = document.getElementById('scoreboard-list');
  const scoresUl = document.getElementById('scores');
  const bgm = document.getElementById('bgm');
  const hitSound = document.getElementById('hitSound');
  const pauseBtn = document.getElementById('pauseBtn');
  const pauseOverlay = document.getElementById('pauseOverlay');
  const resumeBtn = pauseOverlay.querySelector('.resume');

  const holes = [];
  let score = 0;
  let gameTimer = null;
  let countdownTimer = null;

  const gameDuration = 30;
  let timeLeft = gameDuration;

  let moleInterval = 1000;
  const moleVisibleTime = 800;
  const moleImgUrl = 'https://i.postimg.cc/D0p0cdj3/pngegg.png';

  // 잠금 관련
  let lastTouchEnd = 0;
  let lockScrollY = 0;
  let isLocked = false;
  const prevent = (e)=>{ e.preventDefault(); };
  const preventScroll = ()=>{ window.scrollTo(0, lockScrollY); };

  function enableInputLock(){
    if(isLocked) return;
    isLocked = true;
    lockScrollY = window.scrollY || 0;

    document.documentElement.classList.add('lock','playing');
    document.body.classList.add('lock','playing');
    document.body.style.top = `-${lockScrollY}px`;

    document.addEventListener('touchmove', prevent, {passive:false});
    document.addEventListener('gesturestart', prevent, {passive:false});
    document.addEventListener('touchend', (e)=>{
      const now = Date.now();
      if(now - lastTouchEnd < 300){ e.preventDefault(); }
      lastTouchEnd = now;
    }, {passive:false});
    window.addEventListener('scroll', preventScroll, {passive:false});
    window.addEventListener('keydown', blockKeys, {capture:true});
  }
  function disableInputLock(){
    if(!isLocked) return;
    isLocked = false;
    document.documentElement.classList.remove('lock','playing');
    document.body.classList.remove('lock','playing');
    document.removeEventListener('touchmove', prevent);
    document.removeEventListener('gesturestart', prevent);
    window.removeEventListener('scroll', preventScroll);
    window.removeEventListener('keydown', blockKeys, {capture:true});
    const y = lockScrollY;
    document.body.style.top = '';
    window.scrollTo(0, y);
  }
  function blockKeys(e){
    const keys = ['Space','ArrowUp','ArrowDown','ArrowLeft','ArrowRight','PageUp','PageDown','Home','End'];
    if(keys.includes(e.code)){ e.preventDefault(); }
  }

  // 일시정지 상태
  let running = false;
  let paused  = false;

  function setPaused(state){
    if(!running) return;
    paused = state;
    if(paused){
      // 스폰 중단 & BGM 일시정지
      clearInterval(gameTimer);
      bgm.pause();
      // 오버레이 표시, 버튼 텍스트 변경
      pauseOverlay.classList.add('show');
      pauseOverlay.setAttribute('aria-hidden', 'false');
      pauseBtn.textContent = '▶️ Resume';
    }else{
      // 스폰 재개 & BGM 재개
      clearInterval(gameTimer);
      gameTimer = setInterval(showMoles, moleInterval);
      bgm.play().catch(()=>{});
      // 오버레이 숨김, 버튼 텍스트 변경
      pauseOverlay.classList.remove('show');
      pauseOverlay.setAttribute('aria-hidden', 'true');
      pauseBtn.textContent = '⏸️ Pause';
    }
  }

  function createGrid() {
    for(let i=0; i<9; i++) {
      const hole = document.createElement('div');
      hole.classList.add('hole');
      const mole = document.createElement('img');
      mole.src = moleImgUrl;
      mole.classList.add('mole');
      hole.appendChild(mole);
      grid.appendChild(hole);
      holes.push({hole, mole});
      mole.addEventListener('click', whack);
      mole.addEventListener('touchstart', whack, {passive:false});
    }
  }

  function updateDifficulty() {
    moleInterval = Math.max(300, 1000 - Math.floor(score / 10) * 100);
    // 재개 시 최신 템포 반영
    if(running && !paused){
      clearInterval(gameTimer);
      gameTimer = setInterval(showMoles, moleInterval);
    }
  }

  function showMoles() {
    if(paused) return;
    let moleCount = score>=25 ? 3 : score>=10 ? 2 : 1;
    let holesAvailable = holes.filter(h => !h.mole.classList.contains('up'));
    moleCount = Math.min(moleCount, holesAvailable.length);
    for(let i=0; i<moleCount; i++) {
      const idx = Math.floor(Math.random() * holesAvailable.length);
      const { mole } = holesAvailable[idx];
      mole.classList.add('up');
      setTimeout(()=> mole.classList.remove('up'), moleVisibleTime);
      holesAvailable.splice(idx, 1);
    }
  }

  function whack(e) {
    if(e && e.cancelable) e.preventDefault();
    if(paused) return;                 // ⛔ 일시정지 중 클릭 무시
    if(!e.isTrusted) return;
    if(this.classList.contains('up')) {
      score++;
      scoreEl.textContent = score;
      this.classList.remove('up');
      hitSound.currentTime = 0;
      hitSound.play().catch(()=>{});
      clearInterval(gameTimer);
      updateDifficulty();
      gameTimer = setInterval(showMoles, moleInterval);
      showMoles();
    }
  }

  function startCountdown() {
    timeLeft = gameDuration;
    timerEl.textContent = `Time left: ${timeLeft}s`;
    clearInterval(countdownTimer);
    countdownTimer = setInterval(()=>{
      if(paused) return;               // ⏸️ 멈춤
      timeLeft--;
      timerEl.textContent = `Time left: ${timeLeft}s`;
      if(timeLeft <= 0) {
        clearInterval(countdownTimer);
        endGame();
      }
    },1000);
  }

  function endGame() {
    running = false;
    paused = false;
    bgm.pause();
    bgm.currentTime = 0;
    clearInterval(gameTimer);

    // 잠금 해제
    disableInputLock();

    // 오버레이 닫기/버튼 복원
    pauseOverlay.classList.remove('show');
    pauseOverlay.setAttribute('aria-hidden', 'true');
    pauseBtn.textContent = '⏸️ Pause';

    alert(`Time's up! Your score: ${score}`);
    let playerName = prompt('Enter your name for the scoreboard:','Player') || 'Player';
    saveScore(playerName, score);
    displayScores();
    startBtn.disabled = false;
  }

  function saveScore(name, score) {
    const storedScores = JSON.parse(localStorage.getItem('whackScores')) || [];
    storedScores.push({name, score});
    storedScores.sort((a,b)=>b.score-a.score);
    const topScores = storedScores.slice(0,10);
    localStorage.setItem('whackScores', JSON.stringify(topScores));
  }

  function displayScores() {
    const storedScores = JSON.parse(localStorage.getItem('whackScores')) || [];
    scoresUl.innerHTML='';
    if(storedScores.length===0){
      scoresUl.innerHTML='<li>No scores yet.</li>';
    } else {
      storedScores.forEach(({name,score})=>{
        const li=document.createElement('li');
        li.textContent=`${name}: ${score}`;
        scoresUl.appendChild(li);
      });
    }
    scoreboardList.style.display='block';
  }

  function startGame() {
    score=0;
    scoreEl.textContent=score;
    startBtn.disabled=true;
    scoreboardList.style.display='none';
    holes.forEach(({mole})=>mole.classList.remove('up'));

    // 모바일 입력 잠금
    enableInputLock();

    // 상태
    running = true;
    paused = false;

    // BGM
    bgm.currentTime=0;
    bgm.play().catch(()=>{});

    // 게임 루프
    updateDifficulty();
    showMoles();
    clearInterval(gameTimer);
    gameTimer=setInterval(showMoles,moleInterval);
    startCountdown();
  }

  // 헤더 버튼
  document.getElementById('homeLogo').addEventListener('click', ()=>window.scrollTo({top:0, behavior:'smooth'}));
  pauseBtn.addEventListener('click', ()=> setPaused(!paused));
  resumeBtn.addEventListener('click', ()=> setPaused(false));

  createGrid();
  displayScores();
  startBtn.addEventListener('click', startGame);
</script>
</body>
</html>