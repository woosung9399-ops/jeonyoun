<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<title>ë‘ë”ì§€ ì¡ê¸°ê¸°ğŸ¯</title>

<!-- âœ… ì£¼í™©ìƒ‰ ë™ê·¸ë¼ë¯¸ íŒŒë¹„ì½˜ -->
<link rel="icon" href="data:image/svg+xml,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
  <circle cx='50' cy='50' r='45' fill='%23ff9800'/>
</svg>">

<style>
  :root{
    --cell: clamp(82px, 22vw, 120px);
    --gap:  clamp(8px, 2.6vw, 14px);
    --header-pad: max(10px, env(safe-area-inset-top, 0));
    --side-pad: max(12px, env(safe-area-inset-left, 0));
  }
  *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
  html, body { height:100%; overscroll-behavior: none; }

  body{
    margin:0; display:flex; flex-direction:column; align-items:center;
    font-family: ui-sans-serif, system-ui, -apple-system, "Pretendard","Segoe UI",sans-serif;
    background: url('https://i.postimg.cc/QCs9xJCp/image.png') center center / cover no-repeat fixed;
    min-height:100vh;
  }

  /* âœ… í—¤ë”: 1ì—´ ê³ ì • */
  header{
    position:sticky; top:0; z-index:10; width:100%;
    display:flex; align-items:center; justify-content:space-between;
    gap:12px; flex-wrap:nowrap;
    padding: var(--header-pad) calc(var(--side-pad) + 12px) 10px calc(var(--side-pad) + 12px);
    background:#fff; box-shadow: 0 2px 6px rgba(0,0,0,.15);
  }
  .left,.right{display:flex; align-items:center; gap:10px; min-width:auto; flex:0 0 auto;}
  .center{flex:1 1 auto; display:flex; justify-content:center; min-width:0;}
  #homeLogo{ display:inline-flex; align-items:center; cursor:pointer; }
  #homeLogo img{ height:32px; width:auto; object-fit:contain; display:block; }
  .title{
    margin:0; font-size:clamp(16px,4vw,20px); font-weight:800; color:#111;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:100%;
  }
  .btn{
    min-height:38px; min-width:60px; padding:6px 12px; font-size:14px; font-weight:700;
    border:1px solid #d1d5db; border-radius:10px; cursor:pointer; background:#fff; color:#111;
  }

  /* âœ… ìƒíƒœë°” (Time / Score) */
  .statusbar{
    width:100%; display:flex; justify-content:center; gap:10px;
    padding:10px calc(var(--side-pad) + 12px) 0;
  }
  .pill{
    background: rgba(255,255,255,.92);
    border:1px solid rgba(17,24,39,.08);
    border-radius:999px; padding:8px 12px; font-weight:700; font-size:14px;
    box-shadow:0 2px 6px rgba(0,0,0,.08);
  }

  .wrap{ width:min(760px,100%); padding:12px calc(var(--side-pad) + 12px) 0 }
  #grid{
    display:grid; grid-template-columns:repeat(3, var(--cell)); grid-auto-rows:var(--cell);
    gap:var(--gap); justify-content:center; width:100%; margin:8px 0 12px;
  }
  .hole{
    position:relative; width:var(--cell); height:var(--cell); border-radius:50%; overflow:hidden;
    background:#6a4a3c; box-shadow: inset 0 8px 24px #2a160f, 0 6px 18px rgba(0,0,0,.25);
  }
  .mole{
    position:absolute; top:60%; left:50%; transform:translate(-50%, -50%);
    width:78%; user-select:none; -webkit-user-drag:none; cursor:pointer; transition: top .18s ease;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,.35));
  }
  .mole.up{ top:28%; }

  /* âœ… Start ë²„íŠ¼ ê°€ìš´ë° ì •ë ¬ */
  .primary{
    display:block; margin:6px auto 0;
    min-height:44px; min-width:160px; padding:12px 20px;
    font-size:16px; font-weight:800; border-radius:12px; border:0; background:#111; color:#fff;
    box-shadow:0 6px 18px rgba(0,0,0,.25);
  }

  /* âœ… ë­í‚¹ ë°•ìŠ¤ */
  #scoreboard-list{ width:min(760px,100%); padding:0 calc(var(--side-pad) + 12px); margin:16px auto 18px; }
  #scoreboard-list h2{ margin:6px 0 10px; color:#fff; text-shadow:0 1px 6px rgba(0,0,0,.45); font-size:clamp(16px,4vw,20px); }
  .rank-card{
    background:rgba(255,255,255,.94); padding:10px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.15);
  }
  .register{
    display:flex; gap:8px; align-items:center; margin-bottom:10px; flex-wrap:wrap;
  }
  .register b{font-size:14px;}
  .register input{
    flex:1 1 180px; min-width:120px;
    padding:10px 12px; border:1px solid #d1d5db; border-radius:10px; font-size:14px;
  }
  .register button{
    padding:10px 14px; border:0; border-radius:10px; background:#111; color:#fff; font-weight:800; cursor:pointer;
  }
  #scores{ list-style:none; padding:0; margin:0; }
  #scores li{
    background:#fff; margin-bottom:6px; padding:8px 12px; border-radius:10px;
    box-shadow:0 1px 4px rgba(0,0,0,.08); display:flex; justify-content:space-between; font-weight:700;
  }

  /* âœ… ì¼ì‹œì •ì§€ ì˜¤ë²„ë ˆì´ */
  .overlay{
    position:fixed; inset:0; background:rgba(0,0,0,.45);
    display:none; align-items:center; justify-content:center; z-index:20;
    backdrop-filter: blur(2px);
  }
  .overlay .card{
    background:#fff; color:#111; padding:18px 22px; border-radius:14px; font-weight:800; font-size:18px;
    box-shadow:0 12px 28px rgba(0,0,0,.25);
  }

  footer{
    margin-top:auto; width:100%; text-align:center;
    padding:14px calc(var(--side-pad) + 12px) max(12px, env(safe-area-inset-bottom, 0));
    background: rgba(0,0,0,.6); color:#fff; font-size:14px;
  }
</style>
</head>
<body>

<header>
  <div class="left">
    <div id="homeLogo" role="button" tabindex="0" title="ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ì´ë™">
      <img src="https://api.multicampus.com/ssf/v1/resource/public/images/FILBS202506207041267" alt="multicampus ë¡œê³ " />
    </div>
  </div>
  <div class="center">
    <h1 class="title">ë‘ë”ì§€ ì¡ê¸° ëŒ€ì‘ì „</h1>
  </div>
  <div class="right">
    <button id="pauseBtn" class="btn">â¸ï¸ Pause</button>
  </div>
</header>

<!-- ìƒíƒœë°” -->
<div class="statusbar" aria-live="polite">
  <div class="pill" id="timer">Time left: 30s</div>
  <div class="pill">Score: <span id="score">0</span></div>
</div>

<div class="wrap">
  <div id="grid"></div>
  <button id="start" class="primary">Start Game</button>

  <!-- âœ… ê²Œì„ ì¢…ë£Œ ì‹œ ìë™ í‘œì‹œ + ë“±ë¡ ê°€ëŠ¥ -->
  <div id="scoreboard-list" style="display:none;">
    <h2>ğŸ‘‘ Scoreboard</h2>
    <div class="rank-card">
      <div class="register" id="registerBox" style="display:none;">
        <b id="finalScoreText">ìµœì¢… ì ìˆ˜: 0</b>
        <input id="playerName" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="16" />
        <button id="saveScoreBtn">ë“±ë¡</button>
      </div>
      <ul id="scores"></ul>
    </div>
  </div>
</div>

<!-- ì¼ì‹œì •ì§€ ì˜¤ë²„ë ˆì´ -->
<div id="pauseOverlay" class="overlay" aria-hidden="true">
  <div class="card">â¸ï¸ Paused</div>
</div>

<audio id="bgm" src="https://www.dropbox.com/scl/fi/05ytgdfewmcgokh7onrzp/770707__audiocoffee__children-game-loop-ver.wav?rlkey=elzlfgeetnf16zieb8nrmri5j&raw=1" loop></audio>
<audio id="hitSound" src="https://www.dropbox.com/scl/fi/azmq2hkl45wns76novc2k/85591__jankoehl__hit-wood10.wav?rlkey=rcjxyhs5frxc1qaw0o2eegpku&raw=1"></audio>

<footer>Â© multicampus arcade</footer>

<script>
  // ìš”ì†Œ ì°¸ì¡°
  const grid = document.getElementById('grid');
  const scoreEl = document.getElementById('score');
  const startBtn = document.getElementById('start');
  const timerEl = document.getElementById('timer');
  const scoreboardList = document.getElementById('scoreboard-list');
  const scoresUl = document.getElementById('scores');
  const bgm = document.getElementById('bgm');
  const hitSound = document.getElementById('hitSound');
  const pauseBtn = document.getElementById('pauseBtn');
  const pauseOverlay = document.getElementById('pauseOverlay');
  const homeLogo = document.getElementById('homeLogo');

  const registerBox = document.getElementById('registerBox');
  const finalScoreText = document.getElementById('finalScoreText');
  const playerNameInput = document.getElementById('playerName');
  const saveScoreBtn = document.getElementById('saveScoreBtn');

  // ìƒíƒœ
  const holes = [];
  let score = 0;
  let gameTimer = null;
  let countdownTimer = null;

  const gameDuration = 30;
  let timeLeft = gameDuration;
  let moleInterval = 1000;
  const moleVisibleTime = 800;
  const moleImgUrl = 'https://i.postimg.cc/D0p0cdj3/pngegg.png';

  let isRunning = false;
  let isPaused = false;
  let lastGameScore = 0; // ì¢…ë£Œ í›„ ë“±ë¡ìš©

  function createGrid() {
    for(let i=0; i<9; i++) {
      const hole = document.createElement('div');
      hole.classList.add('hole');
      const mole = document.createElement('img');
      mole.src = moleImgUrl;
      mole.classList.add('mole');
      hole.appendChild(mole);
      grid.appendChild(hole);
      holes.push({hole, mole});
      mole.addEventListener('click', whack, {passive:true});
    }
  }

  function updateDifficulty() {
    moleInterval = Math.max(300, 1000 - Math.floor(score / 10) * 100);
  }

  function showMoles() {
    if (!isRunning || isPaused) return;
    let moleCount = score>=25 ? 3 : score>=10 ? 2 : 1;
    let holesAvailable = holes.filter(h => !h.mole.classList.contains('up'));
    moleCount = Math.min(moleCount, holesAvailable.length);
    for(let i=0; i<moleCount; i++) {
      const idx = Math.floor(Math.random() * holesAvailable.length);
      const { mole } = holesAvailable[idx];
      mole.classList.add('up');
      setTimeout(()=> mole.classList.remove('up'), moleVisibleTime);
      holesAvailable.splice(idx, 1);
    }
  }

  function whack(e) {
    if(!e.isTrusted || !isRunning || isPaused) return;
    if(this.classList.contains('up')) {
      score++;
      scoreEl.textContent = score;
      this.classList.remove('up');
      hitSound.currentTime = 0;
      hitSound.play();
      clearInterval(gameTimer);
      updateDifficulty();
      gameTimer = setInterval(showMoles, moleInterval);
      showMoles();
    }
  }

  function startCountdown() {
    timeLeft = gameDuration;
    timerEl.textContent = `Time left: ${timeLeft}s`;
    countdownTimer = setInterval(()=>{
      if (isPaused) return;
      timeLeft--;
      timerEl.textContent = `Time left: ${timeLeft}s`;
      if(timeLeft <= 0) {
        clearInterval(countdownTimer);
        endGame();
      }
    },1000);
  }

  function endGame() {
    isRunning = false;
    isPaused = false;
    pauseOverlay.style.display = 'none';
    pauseOverlay.setAttribute('aria-hidden','true');

    bgm.pause();
    bgm.currentTime = 0;
    clearInterval(gameTimer);
    clearInterval(countdownTimer);

    // âœ… ë­í‚¹ ìë™ í‘œì‹œ + ë“±ë¡ ê°€ëŠ¥
    lastGameScore = score;
    finalScoreText.textContent = `ìµœì¢… ì ìˆ˜: ${lastGameScore}`;
    playerNameInput.value = '';
    registerBox.style.display = 'flex';
    scoreboardList.style.display = 'block';

    displayScores();

    startBtn.disabled = false;
    pauseBtn.disabled = true;
    pauseBtn.textContent = 'â¸ï¸ Pause';

    // ì…ë ¥ì— í¬ì»¤ìŠ¤
    setTimeout(()=> playerNameInput.focus(), 0);
  }

  function saveScore(name, score) {
    const storedScores = JSON.parse(localStorage.getItem('whackScores')) || [];
    storedScores.push({name, score});
    storedScores.sort((a,b)=>b.score-a.score);
    const topScores = storedScores.slice(0,10);
    localStorage.setItem('whackScores', JSON.stringify(topScores));
  }

  function displayScores() {
    const storedScores = JSON.parse(localStorage.getItem('whackScores')) || [];
    scoresUl.innerHTML='';
    if(storedScores.length===0){
      const li=document.createElement('li');
      li.textContent='No scores yet.';
      scoresUl.appendChild(li);
    } else {
      storedScores.forEach(({name,score}, idx)=>{
        const li=document.createElement('li');
        li.textContent=`${idx+1}. ${name}`;
        const span=document.createElement('span');
        span.textContent=score;
        li.appendChild(span);
        scoresUl.appendChild(li);
      });
    }
  }

  function startGame() {
    score=0;
    scoreEl.textContent=score;
    holes.forEach(({mole})=>mole.classList.remove('up'));

    isRunning = true;
    isPaused = false;
    startBtn.disabled=true;
    pauseBtn.disabled=false;
    pauseBtn.textContent = 'â¸ï¸ Pause';

    // ì‹œì‘ ì‹œ ë­í‚¹ ë“±ë¡ ë°•ìŠ¤ ê°ì¶”ê¸°
    registerBox.style.display = 'none';

    bgm.currentTime=0;
    bgm.play().catch(()=>{});

    updateDifficulty();
    showMoles();
    clearInterval(gameTimer);
    gameTimer=setInterval(showMoles,moleInterval);
    clearInterval(countdownTimer);
    startCountdown();
  }

  function togglePause(){
    if (!isRunning) return;
    isPaused = !isPaused;
    if (isPaused){
      bgm.pause();
      clearInterval(gameTimer);
      pauseOverlay.style.display = 'flex';
      pauseOverlay.setAttribute('aria-hidden','false');
      pauseBtn.textContent = 'â–¶ï¸ Resume';
    } else {
      bgm.play().catch(()=>{});
      updateDifficulty();
      gameTimer = setInterval(showMoles, moleInterval);
      showMoles();
      pauseOverlay.style.display = 'none';
      pauseOverlay.setAttribute('aria-hidden','true');
      pauseBtn.textContent = 'â¸ï¸ Pause';
    }
  }

  // ë“±ë¡ ë²„íŠ¼ ë™ì‘
  saveScoreBtn.addEventListener('click', ()=>{
    const name = (playerNameInput.value || 'Player').trim().slice(0,16);
    saveScore(name, lastGameScore);
    displayScores();
    registerBox.style.display = 'none';
  });

  // Enterë¡œë„ ë“±ë¡
  playerNameInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      saveScoreBtn.click();
    }
  });

  // ë¡œê³  í´ë¦­ ì‹œ ì´ˆê¸°í™”(í™ˆ ëŠë‚Œ)
  function goHome(){
    isRunning = false; isPaused = false;
    bgm.pause(); bgm.currentTime = 0;
    clearInterval(gameTimer); clearInterval(countdownTimer);
    holes.forEach(({mole})=>mole.classList.remove('up'));
    timeLeft = gameDuration;
    timerEl.textContent = `Time left: ${timeLeft}s`;
    score = 0; scoreEl.textContent = score;
    startBtn.disabled = false;
    pauseBtn.disabled = true;
    pauseBtn.textContent = 'â¸ï¸ Pause';
    pauseOverlay.style.display = 'none';
    // ë­í‚¹ì€ ìœ ì§€í•˜ë˜ ë“±ë¡ ë°•ìŠ¤ë§Œ ê°ì¶¤
    registerBox.style.display='none';
    window.scrollTo({top:0, behavior:'smooth'});
  }

  // ì´ˆê¸°í™”
  createGrid();
  displayScores();
  startBtn.addEventListener('click', startGame);
  pauseBtn.addEventListener('click', togglePause);
  pauseBtn.disabled = true;
  homeLogo.addEventListener('click', goHome);
</script>
</body>
</html>