<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<title>Whack-a-Mole ğŸ¯</title>
<style>
  :root{
    --cell: clamp(82px, 22vw, 120px);
    --gap:  clamp(8px, 2.6vw, 14px);
    --header-pad: max(10px, env(safe-area-inset-top, 0));
    --side-pad: max(12px, env(safe-area-inset-left, 0));
  }
  *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
  html, body { height:100%; overscroll-behavior: none; }
  .playing, .playing * { touch-action: none !important; }
  .lock { position: fixed; overflow: hidden; inset: 0; width: 100%; }

  body{
    margin:0; display:flex; flex-direction:column; align-items:center;
    font-family: ui-sans-serif, system-ui, -apple-system, "Pretendard","Segoe UI",sans-serif;
    background: url('https://i.postimg.cc/QCs9xJCp/image.png') center center / cover no-repeat fixed;
    min-height:100vh;
  }

  header{
    position:sticky; top:0; z-index:10; width:100%;
    display:flex; align-items:center; justify-content:space-between;
    padding: var(--header-pad) calc(var(--side-pad) + 12px) 10px calc(var(--side-pad) + 12px);
    background: transparent; backdrop-filter:none; -webkit-backdrop-filter:none; box-shadow:none;
  }
  #homeLogo{ display:inline-flex; align-items:center; cursor:pointer; }
  /* â¬‡ ë¡œê³  ë°°ê²½ì„ í™”ë©´ì—ì„œ íˆ¬ëª…í•˜ê²Œ ë³´ì´ë„ë¡ ì²˜ë¦¬ */
  #homeLogo img{
    height:40px; width:auto; object-fit:contain; image-rendering:auto;
    background: transparent; display:block;
    mix-blend-mode: multiply; /* í° ë°°ê²½ì„ ì‚¬ì‹¤ìƒ íˆ¬ëª…ìœ¼ë¡œ */
  }

  .hud .btn{
    min-height:44px; min-width:44px; padding:8px 14px; font-size:16px; font-weight:700;
    border:0; border-radius:10px; cursor:pointer; background:rgba(17,17,17,.85); color:#fff;
  }

  .wrap{ width:min(760px,100%); padding:12px calc(var(--side-pad) + 12px) 0 }
  h1{ margin:8px 0 6px; color:#fff; text-shadow:0 2px 10px rgba(0,0,0,.4); font-size:clamp(18px,4.5vw,24px); font-weight:800; }
  #timer, #scoreboard{ color:#fff; text-shadow:0 1px 6px rgba(0,0,0,.45); font-size:clamp(14px,3.8vw,18px); margin-bottom:6px; }

  #grid{
    display:grid; grid-template-columns:repeat(3, var(--cell)); grid-auto-rows:var(--cell);
    gap:var(--gap); justify-content:center; width:100%; margin:8px 0 12px;
  }
  .hole{
    position:relative; width:var(--cell); height:var(--cell); border-radius:50%; overflow:hidden;
    background:#6a4a3c; box-shadow: inset 0 8px 24px #2a160f, 0 6px 18px rgba(0,0,0,.25);
  }
  .mole{
    position:absolute; top:60%; left:50%; transform:translate(-50%, -50%);
    width:78%; user-select:none; -webkit-user-drag:none; cursor:pointer; transition: top .18s ease;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,.35));
  }
  .mole.up{ top:28%; }

  button#start{
    display:inline-block; min-height:44px; min-width:120px; padding:10px 20px;
    font-size:16px; font-weight:800; border-radius:12px; border:0; background:#111; color:#fff;
    box-shadow:0 6px 18px rgba(0,0,0,.25);
  }

  #scoreboard-list{ width:min(760px,100%); padding:0 calc(var(--side-pad) + 12px); margin:12px 0 18px; }
  #scoreboard-list h2{ margin:6px 0 8px; color:#fff; text-shadow:0 1px 6px rgba(0,0,0,.45); font-size:clamp(16px,4vw,20px); }
  #scores{ list-style:none; padding:0; margin:0; }
  #scores li{
    background:rgba(255,255,255,.9); margin-bottom:6px; padding:8px 12px; border-radius:10px;
    box-shadow:0 2px 8px rgba(0,0,0,.18); display:flex; justify-content:space-between; font-weight:700;
  }

  #pauseOverlay{
    position: fixed; inset:0; display:none; place-items:center;
    background: rgba(0,0,0,.4);
    z-index: 20; color:#fff; text-align:center; padding:20px;
  }
  #pauseOverlay.show{ display:grid; }
  #pauseOverlay .card{
    background: rgba(0,0,0,.55);
    border: 1px solid rgba(255,255,255,.18);
    padding: 16px 20px; border-radius: 14px; backdrop-filter: blur(2px);
    max-width: 90vw;
  }
  #pauseOverlay h2{ margin: 0 0 6px; font-size: 22px; }
  #pauseOverlay p{ margin: 0 0 10px; opacity: .9; }
  #pauseOverlay .resume{
    padding:10px 18px; border-radius:12px; border:0; font-weight:800; font-size:16px; cursor:pointer;
  }

  footer{
    margin-top:auto; width:100%; text-align:center;
    padding:14px calc(var(--side-pad) + 12px) max(12px, env(safe-area-inset-bottom, 0));
    background: rgba(0,0,0,.6); color:#fff; font-size:14px;
  }

  @media (max-width: 600px){
    body{ background-attachment: scroll; }
    #grid{ gap:max(8px, 2vw); }
  }
</style>
</head>
<body>

<header>
  <div id="homeLogo" role="button" tabindex="0" title="ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ì´ë™">
    <img src="https://api.multicampus.com/ssf/v1/resource/public/images/FILBS202506207041267" alt="multicampus ë¡œê³ " />
  </div>
  <div class="hud" aria-live="polite">
    <button id="pauseBtn" class="btn">â¸ï¸ Pause</button>
  </div>
</header>

<div class="wrap">
  <h1>ë‘ë”ì§€ ì¡ê¸° ëŒ€ì‘ì „</h1>
  <div id="timer">Time left: 30s</div>
  <div id="scoreboard">Score: <span id="score">0</span></div>

  <div id="grid"></div>
  <button id="start">Start Game</button>

  <div id="scoreboard-list" style="display:none;">
    <h2>ğŸ‘‘ Scoreboard</h2>
    <ul id="scores"></ul>
  </div>
</div>

<div id="pauseOverlay" aria-hidden="true">
  <div class="card">
    <h2>ì¼ì‹œì •ì§€ â¸ï¸</h2>
    <p>ê³„ì†í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
    <button class="resume">â–¶ï¸ Resume</button>
  </div>
</div>

<audio id="bgm" src="https://www.dropbox.com/scl/fi/05ytgdfewmcgokh7onrzp/770707__audiocoffee__children-game-loop-ver.wav?rlkey=elzlfgeetnf16zieb8nrmri5j&raw=1" loop></audio>
<audio id="hitSound" src="https://www.dropbox.com/scl/fi/azmq2hkl45wns76novc2k/85591__jankoehl__hit-wood10.wav?rlkey=rcjxyhs5frxc1qaw0o2eegpku&raw=1"></audio>

<footer>Â© multicampus arcade</footer>

<script>
  // ======= ë‚œì´ë„/ì†ë„ íŠœë‹ íŒŒë¼ë¯¸í„° =======
  const CONFIG = {
    SPAWN_BASE_MS: 850,     // ê¸°ë³¸ ìŠ¤í° ê°„ê²©
    SPAWN_MIN_MS:  220,     // ìµœì†Œ ìŠ¤í° ê°„ê²©(ë” ì‘ì„ìˆ˜ë¡ ë¹ ë¦„)
    SCORE_STEP_MS: 80,      // ì ìˆ˜ 10ì ë§ˆë‹¤ ì¤„ì–´ë“œëŠ” ì–‘
    TIME_STEP_MS:  60,      // ê²½ê³¼ 10ì´ˆë§ˆë‹¤ ì¤„ì–´ë“œëŠ” ì–‘

    VISIBLE_BASE_MS: 780,   // ê¸°ë³¸ ë…¸ì¶œ ì‹œê°„
    VISIBLE_MIN_MS:  420,   // ìµœì†Œ ë…¸ì¶œ ì‹œê°„
    VISIBLE_STEP_MS: 60     // ë‚œì´ë„ ìƒìŠ¹ì‹œ ì¤„ì–´ë“œëŠ” ì–‘(ì ìˆ˜/ì‹œê°„ì˜ í°ìª½ ê¸°ì¤€)
  };
  // ========================================

  const grid = document.getElementById('grid');
  const scoreEl = document.getElementById('score');
  const startBtn = document.getElementById('start');
  const timerEl = document.getElementById('timer');
  const scoreboardList = document.getElementById('scoreboard-list');
  const scoresUl = document.getElementById('scores');
  const bgm = document.getElementById('bgm');
  const hitSound = document.getElementById('hitSound');
  const pauseBtn = document.getElementById('pauseBtn');
  const pauseOverlay = document.getElementById('pauseOverlay');
  const resumeBtn = pauseOverlay.querySelector('.resume');

  const holes = [];
  let score = 0;
  let gameTimer = null;
  let countdownTimer = null;

  const gameDuration = 30;
  let timeLeft = gameDuration;

  // ë™ì ìœ¼ë¡œ ë³€í•  ê°’
  let moleInterval = CONFIG.SPAWN_BASE_MS;
  let moleVisibleTime = CONFIG.VISIBLE_BASE_MS;

  const moleImgUrl = 'https://i.postimg.cc/D0p0cdj3/pngegg.png';

  // ì…ë ¥ ì ê¸ˆ
  let lastTouchEnd = 0;
  let lockScrollY = 0;
  let isLocked = false;
  const prevent = (e)=>{ e.preventDefault(); };
  const preventScroll = ()=>{ window.scrollTo(0, lockScrollY); };
  function enableInputLock(){
    if(isLocked) return;
    isLocked = true; lockScrollY = window.scrollY || 0;
    document.documentElement.classList.add('lock','playing');
    document.body.classList.add('lock','playing');
    document.body.style.top = `-${lockScrollY}px`;
    document.addEventListener('touchmove', prevent, {passive:false});
    document.addEventListener('gesturestart', prevent, {passive:false});
    document.addEventListener('touchend', (e)=>{
      const now = Date.now(); if(now - lastTouchEnd < 300){ e.preventDefault(); } lastTouchEnd = now;
    }, {passive:false});
    window.addEventListener('scroll', preventScroll, {passive:false});
    window.addEventListener('keydown', blockKeys, {capture:true});
  }
  function disableInputLock(){
    if(!isLocked) return; isLocked = false;
    document.documentElement.classList.remove('lock','playing');
    document.body.classList.remove('lock','playing');
    document.removeEventListener('touchmove', prevent);
    document.removeEventListener('gesturestart', prevent);
    window.removeEventListener('scroll', preventScroll);
    window.removeEventListener('keydown', blockKeys, {capture:true});
    const y = lockScrollY; document.body.style.top = ''; window.scrollTo(0, y);
  }
  function blockKeys(e){
    const keys = ['Space','ArrowUp','ArrowDown','ArrowLeft','ArrowRight','PageUp','PageDown','Home','End'];
    if(keys.includes(e.code)) e.preventDefault();
  }

  // ì¼ì‹œì •ì§€ ìƒíƒœ
  let running = false;
  let paused  = false;
  function setPaused(state){
    if(!running) return;
    paused = state;
    if(paused){
      clearInterval(gameTimer);
      bgm.pause();
      pauseOverlay.classList.add('show');
      pauseOverlay.setAttribute('aria-hidden', 'false');
      pauseBtn.textContent = 'â–¶ï¸ Resume';
    } else {
      clearInterval(gameTimer);
      gameTimer = setInterval(showMoles, moleInterval);
      bgm.play().catch(()=>{});
      pauseOverlay.classList.remove('show');
      pauseOverlay.setAttribute('aria-hidden', 'true');
      pauseBtn.textContent = 'â¸ï¸ Pause';
    }
  }

  function createGrid() {
    for(let i=0; i<9; i++) {
      const hole = document.createElement('div');
      hole.classList.add('hole');
      const mole = document.createElement('img');
      mole.src = moleImgUrl;
      mole.classList.add('mole');
      hole.appendChild(mole);
      grid.appendChild(hole);
      holes.push({hole, mole});
      mole.addEventListener('click', whack);
      mole.addEventListener('touchstart', whack, {passive:false});
    }
  }

  // âœ… ì ìˆ˜ì™€ ì‹œê°„ ê¸°ë°˜ìœ¼ë¡œ ìŠ¤í°/ë…¸ì¶œ ì†ë„ ê³„ì‚°
  function updateDifficulty() {
    const elapsed = gameDuration - timeLeft;            // ê²½ê³¼ ì‹œê°„ (ì´ˆ)
    const scoreTier = Math.floor(score / 10);           // 10ì  ë‹¨ìœ„
    const timeTier  = Math.floor(elapsed / 10);         // 10ì´ˆ ë‹¨ìœ„
    const tier = Math.max(scoreTier, timeTier);         // ë” ì–´ë ¤ìš´ìª½ ê¸°ì¤€

    // ìŠ¤í° ê°„ê²© ì¤„ì´ê¸°
    const byScore = scoreTier * CONFIG.SCORE_STEP_MS;
    const byTime  = timeTier  * CONFIG.TIME_STEP_MS;
    moleInterval = Math.max(CONFIG.SPAWN_MIN_MS, CONFIG.SPAWN_BASE_MS - Math.max(byScore, byTime));

    // ë…¸ì¶œ ì‹œê°„ë„ ì ì§„ì ìœ¼ë¡œ ë‹¨ì¶•
    moleVisibleTime = Math.max(CONFIG.VISIBLE_MIN_MS, CONFIG.VISIBLE_BASE_MS - tier * CONFIG.VISIBLE_STEP_MS);

    // ì§„í–‰ ì¤‘ì´ë©´ ì¦‰ì‹œ ë°˜ì˜
    if(running && !paused){
      clearInterval(gameTimer);
      gameTimer = setInterval(showMoles, moleInterval);
    }
  }

  function showMoles() {
    if(paused) return;
    let moleCount = score>=25 ? 3 : score>=10 ? 2 : 1;
    let holesAvailable = holes.filter(h => !h.mole.classList.contains('up'));
    moleCount = Math.min(moleCount, holesAvailable.length);
    for(let i=0; i<moleCount; i++) {
      const idx = Math.floor(Math.random() * holesAvailable.length);
      const { mole } = holesAvailable[idx];
      mole.classList.add('up');
      setTimeout(()=> mole.classList.remove('up'), moleVisibleTime);
      holesAvailable.splice(idx, 1);
    }
  }

  function whack(e) {
    if(e && e.cancelable) e.preventDefault();
    if(paused) return;
    if(!e.isTrusted) return;
    if(this.classList.contains('up')) {
      score++;
      scoreEl.textContent = score;
      this.classList.remove('up');
      hitSound.currentTime = 0;
      hitSound.play().catch(()=>{});
      // ë‚œì´ë„ ì¦‰ì‹œ ê°±ì‹ 
      updateDifficulty();
      clearInterval(gameTimer);
      gameTimer = setInterval(showMoles, moleInterval);
      showMoles();
    }
  }

  function startCountdown() {
    timeLeft = gameDuration;
    timerEl.textContent = `Time left: ${timeLeft}s`;
    clearInterval(countdownTimer);
    countdownTimer = setInterval(()=>{
      if(paused) return;
      timeLeft--;
      timerEl.textContent = `Time left: ${timeLeft}s`;
      updateDifficulty(); // â¬… ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ë‚œì´ë„ ë°˜ì˜
      if(timeLeft <= 0) {
        clearInterval(countdownTimer);
        endGame();
      }
    },1000);
  }

  function endGame() {
    running = false;
    paused = false;
    bgm.pause();
    bgm.currentTime = 0;
    clearInterval(gameTimer);
    disableInputLock();
    pauseOverlay.classList.remove('show');
    pauseOverlay.setAttribute('aria-hidden', 'true');
    pauseBtn.textContent = 'â¸ï¸ Pause';

    alert(`Time's up! Your score: ${score}`);
    let playerName = prompt('Enter your name for the scoreboard:','Player') || 'Player';
    saveScore(playerName, score);
    displayScores();
    startBtn.disabled = false;
  }

  function saveScore(name, score) {
    const storedScores = JSON.parse(localStorage.getItem('whackScores')) || [];
    storedScores.push({name, score});
    storedScores.sort((a,b)=>b.score-a.score);
    const topScores = storedScores.slice(0,10);
    localStorage.setItem('whackScores', JSON.stringify(topScores));
  }

  function displayScores() {
    const storedScores = JSON.parse(localStorage.getItem('whackScores')) || [];
    scoresUl.innerHTML='';
    if(storedScores.length===0){
      scoresUl.innerHTML='<li>No scores yet.</li>';
    } else {
      storedScores.forEach(({name,score})=>{
        const li=document.createElement('li');
        li.textContent=`${name}: ${score}`;
        scoresUl.appendChild(li);
      });
    }
    scoreboardList.style.display='block';
  }

  function startGame() {
    score=0;
    scoreEl.textContent=score;
    startBtn.disabled=true;
    scoreboardList.style.display='none';
    holes.forEach(({mole})=>mole.classList.remove('up'));

    enableInputLock();
    running = true; paused = false;

    bgm.currentTime=0;
    bgm.play().catch(()=>{});

    // ì´ˆê¸° ë‚œì´ë„ ë°˜ì˜ í›„ ì‹œì‘
    updateDifficulty();
    showMoles();
    clearInterval(gameTimer);
    gameTimer=setInterval(showMoles,moleInterval);
    startCountdown();
  }

  document.getElementById('homeLogo').addEventListener('click', ()=>window.scrollTo({top:0, behavior:'smooth'}));
  pauseBtn.addEventListener('click', ()=> setPaused(!paused));
  resumeBtn.addEventListener('click', ()=> setPaused(false));

  function blockKeys(e){
    const keys = ['Space','ArrowUp','ArrowDown','ArrowLeft','ArrowRight','PageUp','PageDown','Home','End'];
    if(keys.includes(e.code)) e.preventDefault();
  }

  createGrid();
  displayScores();
  startBtn.addEventListener('click', startGame);
</script>
</body>
</html>